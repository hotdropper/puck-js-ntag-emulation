function b(a,b,c,d){this.ser=a;this.onCommand=b;this.onTimeout=c;this.onErr=d;this.ser.on("data",this.onData.bind(this));this.stop();this.vrstate=-1;this.stsr="o";this.rcvv="";this.tout=0;this.lstC=""}exports.connect=function(a,e,c,d){return new b(a,e,c,d)};b.prototype.argchar=function(a){if(-1>a||31<a)throw"Bad arg";return String.fromCharCode(65+a)};b.prototype.chararg=function(a){return a.charCodeAt(0)-65};b.prototype.onData=function(a){96<a.charCodeAt(0)?this.sts_idx[a].len?(this.stsr=
a,this.ser.print(" ")):this.sts_idx[a].cb.bind(this)():(this.rcvv+=a,this.rcvv.length>=this.sts_idx[this.stsr].len?(this.sts_idx[this.stsr].cb.bind(this)(),this.rcvv="",this.stsr="o"):this.ser.print(" "))};b.prototype.sts_idx={o:{len:0,cb:function(){"o"==this.lstC&&-1!=this.vrstate&&this.sendCmd("d",this.vrstate)}},t:{len:0,cb:function(){-1!=this.vrstate&&(this.onTimeout(this.vrstate),this.vrstate=-1)}},v:{len:0,cb:function(){-1!=this.vrstate&&(this.vrstate=-1)}},i:{len:0,cb:function(){-1!=this.vrstate&&
(this.vrstate=-1)}},e:{len:2,cb:function(){if(-1!=this.vrstate){var a=this.vrstate;this.vrstate=-1;this.onErr(a)}}},s:{len:1,cb:function(){if(-1!=this.vrstate){var a=this.vrstate;this.vrstate=-1;this.onErr(a)}}},r:{len:1,cb:function(){if(-1!=this.vrstate){var a=this.onCommand(this.vrstate,this.chararg(this.rcvv));this.vrstate=-1;void 0!==a.type&&this.setRecognize(a.type,a.timeout)}}}};b.prototype.setRecognize=function(a,b){this.tout&&(clearTimeout(this.tout),this.tout=0);this.vrstate=a;this.timeout(b)};
b.prototype.sendCmd=function(a,b){this.ser.print(a);this.lstC=a;void 0!==b&&this.ser.print(this.argchar(b))};b.prototype.stop=function(){this.sendCmd("b")};b.prototype.timeout=function(a){this.sendCmd("o",a)};b.prototype.setStrict=function(a){this.sendCmd("v",E.clip(a,1,5))}