function d(a,b){this.i2c=a;b=b||{};this.addr=b.addr||64;this.maxCurrent=b.maxCurrent||10;this.currentLSB=this.maxCurrent/32768;this.shunt=b.shunt||.1;if(21577!=this.rd(254))throw Error("Invalid manufacturer ID");b.average=b.average||256;var c=[1,4,16,64,128,256,512,1024].indexOf(b.average);if(0>c)throw Error("average must be 1,4,16,64,128,256,512 or 1024");this.wr(0,16679|c<<9);c=Math.round(.00512/(this.currentLSB*this.shunt));if(0>c||32767<c)throw Error("maxCurrent/shunt mean calibration is out of range");
this.wr(5,c);this.wr(6,1024)}d.prototype.rd=function(a){this.i2c.writeTo(this.addr,a);a=this.i2c.readFrom(this.addr,2);return a[1]|a[0]<<8};d.prototype.wr=function(a,b){this.i2c.writeTo(this.addr,[a,b>>8,b])};d.prototype.rds=function(a){a=this.rd(a);return a&32768?a-65536:a};d.prototype.read=function(){var a=this.rd(6);return{vshunt:2.5E-6*this.rds(1),vbus:.00125*this.rd(2),power:25*this.rd(3)*this.currentLSB,current:this.rds(4)*this.currentLSB,overflow:0!=(a&4)}};exports=d