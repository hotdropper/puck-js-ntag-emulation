function e(a,c){this.device=a;this.auth=c}function g(a,c,d,b,f){"function"!==typeof f&&(f=void 0);b=b?JSON.stringify(b):void 0;a={host:"api.losant.com",path:c,method:a,headers:{"Content-Type":"application/json",Accept:"application/json"}};b&&(a.headers["Content-Length"]=b.length);d&&(a.headers.Authorization="Bearer "+d);var e="";d=h.request(a,function(a){a.on("data",function(a){e+=a});a.on("close",function(){f&&f(void 0,JSON.parse(e))});a.on("end",function(){f&&f(void 0,JSON.parse(e))})});
d.on("error",function(a){f&&f(a)});d.end(b)}var h=require("http");e.prototype.getDeviceAuthToken=function(a){g("POST","/auth/device",void 0,{deviceId:this.device,key:this.auth.key,secret:this.auth.secret},a)};e.prototype.updateDeviceData=function(a,c){this.getDeviceAuthToken(function(d,b){d?"function"===typeof c&&c(d):g("POST","/applications/"+b.applicationId+"/devices/"+b.deviceId+"/state",b.token,{data:a},c)})};e.prototype.getDeviceCommand=function(a,c){this.getDeviceAuthToken(function(d,b){d?"function"===
typeof c&&c(d):g("GET","/applications/"+b.applicationId+"/devices/"+b.deviceId+"/command?limit=20"+(void 0!==a?"&since="+a:""),b.token,void 0,c)})};exports.setup=function(a,c){return new e(a,c)}