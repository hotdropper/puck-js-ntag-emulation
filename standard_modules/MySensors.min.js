function b(a){isNaN(a)||255<a?this.nodeId=255:this.nodeId=a}b.prototype.connection={write:function(){console.log("No Gateway")}};b.prototype.nodeId=255;b.prototype.fragment="";b.prototype.parse=function(a){print(a);a=a.split("\n");a[0]=this.fragment+a[0];this.fragment=a.pop();for(var c=0;c<a.length;c++){var b=a[c].split(";");b[5]=b.slice(5).join(";");this.handler(b.slice(0,6))}};b.prototype.present=function(a,c){var b=this.newMessage(a,c);b.payload="2.0";b.messageType=0;this.send(b)};
b.prototype.newMessage=function(a,c){return{nodeId:this.nodeId,childSensorId:a,messageType:1,ack:0,subType:c,payload:""}};b.prototype.send=function(){console.log("No Gateway")};b.prototype.handler=function(a){if(a[0]==JSON.stringify(this.nodeId))switch(a[2]){case "1":case "2":var c=this.newMessage(a[1],a[4]);c.nodeId=a[0];c.ack=a[3];c.messageType=a[2];c.payload=a[5];this.emit("receive",c);break;case "3":switch(a[4]){case "19":this.emit("presentation");break;case "4":a=JSON.parse(a[5]);isNaN(a)||(this.nodeId=
a,this.emit("presentation"));break;default:console.log("message subtype not implemented:"+a)}break;default:console.log("message type not implemented:"+a)}};b.prototype.setMqttGW=function(a,c,b){this.connection=a;this.pubtopic=c;this.subtopic=b;this.connection.on("message",function(a){var c=a.topic.split("/").slice(1);this.parse(c.join(";")+";"+a.message+"\n")}.bind(this));this.send=function(a){this.connection.publish(this.pubtopic+"/"+a.nodeId+"/"+a.childSensorId+"/"+a.messageType+"/"+a.ack+"/"+a.subType,
JSON.stringify(a.payload))}.bind(this);this.connection.subscribe(this.subtopic+"/+/+/+/+/+");this.emit("presentation")};b.prototype.setSerialGW=function(a){this.connection=a;this.connection.on("data",this.parse.bind(this));this.send=function(a){a=a.nodeId+";"+a.childSensorId+";"+a.messageType+";"+a.ack+";"+a.subType+";"+JSON.stringify(a.payload)+"\n";this.connection.write(a)}.bind(this);this.emit("presentation")};b.prototype.disconnectGW=function(){this.connection={};this.send=function(){console.log("No Gateway")}};
exports.create=function(a){return new b(a)}