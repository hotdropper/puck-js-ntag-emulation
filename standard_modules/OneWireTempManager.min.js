var h=require("DS18B20"),c=function(a){var b;this.buses=[];this.sensors=[];this.pollTimer=this.scanTimer=null;if(Array.isArray(a))for(b=0;b<a.length;b++)this._addBusOrPin(a[b]);else this._addBusOrPin(a)};c.prototype.C={SCAN_PERIOD:5E3,POLL_PERIOD:1E3};c.prototype._addBusOrPin=function(a){a instanceof OneWire||(a=new OneWire(a));this.buses.push(a)};c.prototype._getBus=function(a){for(var b=0;b<this.buses.length;b++){var d=this.buses[b];if(String(d.pin)==String(a))return d}throw Error("_getBus:"+
a);};c.prototype.scan=function(){var a,b,d=[],c=this.sensors;for(a=0;a<this.buses.length;a++){var f=this.buses[a],e=f.search();for(b=0;b<e.length;b++)40==parseInt(e[b].substr(0,2),16)&&d.push(f.pin+"="+e[b])}b=function(b,a){return a.filter(function(a){return 0>b.indexOf(a)})};f=function(a){return a.bus.pin+"="+a.sCode};var g=[];for(a=0;a<c.length;a++)g.push(f(c[a]));e=b(g,d);d=b(d,g);for(a=0;a<e.length;a++)b=e[a].split("="),console.log("Add TS sensor: "+b[1]+" bus "+b[0]),b=h.connect(this._getBus(b[0]),
b[1]),this.configureSensor(b),c.push(b);for(a=0;a<d.length;a++)for(b=d[a].split("="),console.log("Del TS sensor: "+b[1]+" bus "+b[0]),b=0;b<c.length;b++)if(f(c[b])==d[a]){c.splice(b,1);break}(e.length||d.length)&&console.log("Total TS sensors: "+c.length)};c.prototype.configureSensor=function(a){};c.prototype.poll=function(){var a=this;this.sensors.forEach(function(b){b.getTemp(a.callBack.bind(this,b))})};c.prototype.callBack=function(a,b){console.log("Temp on "+a.sCode+": "+b)};c.prototype.start=
function(){this.stop();this.scan();this.poll();this.scanTimer=setInterval(this.scan.bind(this),this.C.SCAN_PERIOD);this.pollTimer=setInterval(this.poll.bind(this),this.C.POLL_PERIOD)};c.prototype.stop=function(){null!=this.scanTimer&&(clearInterval(this.scanTimer),this.scanTimer=null);null!=this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)};exports.create=function(a){return new c(a)}