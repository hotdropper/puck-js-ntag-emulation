function g(b){b=E.toString(b);var a="",c;for(c in b)a+=(b.charCodeAt(c)+256).toString(16).substr(-2);return a}function h(b,a){for(var c="",f=a;f<b.length;f+=2)c+=String.fromCharCode(parseInt(b.substr(f,2),16));return c}function d(b,a){this.ser=b;this.options=a||{};this.at=require("AT").connect(b);this.options.debug&&this.at.debug();var c=this;this.at.registerLine("mac_rx 1",function(a){c.emit("message",h(a,9))});this.macOn=!0}d.prototype.reset=function(b){this.options.reset?(this.options.reset.reset(),
this.options.reset.set()):this.at.cmd("sys reset\r\n",1E3,b);b&&b()};d.prototype.getVersion=function(b){this.at.cmd("sys get ver\r\n",1E3,function(a){a?(a=a.split(" "),b({type:a[0],version:a[1],date:a.slice(2).join(" ")})):b()})};d.prototype.getStatus=function(b){var a={},c=this.at;(new Promise(function(a){c.cmd("sys get hweui\r\n",500,a)})).then(function(b){a.EUI=b;return new Promise(function(a){c.cmd("sys get vdd\r\n",500,a)})}).then(function(b){a.VDD=parseInt(b,10)/1E3;return new Promise(function(a){c.cmd("mac get appeui\r\n",
500,a)})}).then(function(b){a.appEUI=b;return new Promise(function(a){c.cmd("mac get deveui\r\n",500,a)})}).then(function(b){a.devEUI=b;return new Promise(function(a){c.cmd("mac get band\r\n",500,a)})}).then(function(b){a.band=b;return new Promise(function(a){c.cmd("mac get dr\r\n",500,a)})}).then(function(b){a.dataRate=b;return new Promise(function(a){c.cmd("mac get rxdelay1\r\n",500,a)})}).then(function(b){a.rxDelay1=b;return new Promise(function(a){c.cmd("mac get rxdelay2\r\n",500,a)})}).then(function(b){a.rxDelay2=
b;return new Promise(function(a){c.cmd("mac get rx2 868\r\n",500,a)})}).then(function(c){a.rxFreq2_868=c;b(a)})};d.prototype.LoRaWAN=function(b,a,c,d){var e=this.at;(new Promise(function(a){e.cmd("mac set devaddr "+b+"\r\n",500,a)})).then(function(){return new Promise(function(b){e.cmd("mac set nwkskey "+a+"\r\n",500,b)})}).then(function(){return new Promise(function(a){e.cmd("mac set appskey "+c+"\r\n",500,a)})}).then(function(){return new Promise(function(a){e.cmd("mac join ABP\r\n",2E3,a)})}).then(function(a){d("ok"==
a?null:void 0===a?"Timeout":a)})};d.prototype.setMAC=function(b,a){if(this.macOn==b)return a();this.macOn=b;this.at.cmd("mac "+(b?"resume":"pause")+"\r\n",500,a)};d.prototype.radioTX=function(b,a){var c=this.at;this.setMAC(!1,function(){c.cmd("radio tx "+g(b)+"\r\n",2E3,a)})};d.prototype.loraTX=function(b,a){var c=this.at;this.setMAC(!0,function(){c.cmd("mac tx uncnf 1 "+g(b)+"\r\n",2E3,function(b){a("ok"==b?null:void 0===b?"Timeout":b)})})};d.prototype.radioRX=function(b,a){var c=this.at;this.setMAC(!1,
function(){c.cmd("radio set wdt "+b+"\r\n",500,function(){c.cmd("radio rx 0\r\n",b+500,function k(b){if("ok"==b)return k;void 0===b||"radio_rx  "!=b.substr(0,10)?a():a(h(b,10))})})})};exports=d