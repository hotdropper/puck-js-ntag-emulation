var b=function(a){this.at=require("AT").connect(a);this.at.registerLine("+RCV",this._receive.bind(this))};b.prototype.atcmd=function(a,b){var f=this;return new Promise(function(c,d){f.at.cmd(a+"\r\n",b||5E3,function(b){void 0===b?d(a+": TIMEOUT"):"+ERR"==b.slice(0,4)?d(a+": "+b.slice(1)):c(b)})})};b.prototype._receive=function(a){a=a.slice(5);var b=a.indexOf(","),e=parseInt(a.slice(0,b));a=a.slice(b+1);b=a.indexOf(",");var c=parseInt(a.slice(0,b));a=a.slice(b+1);var d=a.slice(0,c);a=a.slice(c+
1);b=a.indexOf(",");c=parseInt(a.slice(0,b));a=a.slice(b+1);a=parseInt(a);this.emit("data",{address:e,data:d,rssi:c,snr:a})};b.prototype.reset=function(){return this.atcmd("AT+RESET")};b.prototype.setMode=function(a){return this.atcmd("AT+MODE="+a)};b.prototype.getMode=function(){return this.atcmd("AT+MODE?").then(function(a){return parseInt(a.slice(6))})};b.prototype.setBaudRate=function(a){return this.atcmd("AT+IPR="+a)};b.prototype.getBaudRate=function(){return this.atcmd("AT+IPR?").then(function(a){return parseInt(a.slice(5))})};
b.prototype.setParameter=function(a){a=a||{};var b=(a.spreadingFactor||12)+",";b+=(a.bandwidth||7)+",";b+=(a.codingRate||1)+",";b+=a.preamble||4;return this.atcmd("AT+PARAMETER="+b)};b.prototype.getParameter=function(){return this.atcmd("AT+PARAMETER?").then(function(a){a=a.slice(11);a=a.split(",");return{spreadingFactor:parseInt(a[0]),bandwidth:parseInt(a[1]),codingRate:parseInt(a[2]),preamble:parseInt(a[3])}})};b.prototype.setBand=function(a){return this.atcmd("AT+BAND="+a)};b.prototype.getBand=
function(){return this.atcmd("AT+BAND?").then(function(a){return parseInt(a.slice(6))})};b.prototype.setAddress=function(a){return this.atcmd("AT+ADDRESS="+a)};b.prototype.getAddress=function(){return this.atcmd("AT+ADDRESS?").then(function(a){return parseInt(a.slice(9))})};b.prototype.setNetwork=function(a){return this.atcmd("AT+NETWORKID="+a)};b.prototype.getNetwork=function(){return this.atcmd("AT+NETWORKID?").then(function(a){return parseInt(a.slice(11))})};b.prototype.setPassword=function(a){return this.atcmd("AT+CPIN="+
a)};b.prototype.getPassword=function(){return this.atcmd("AT+CPIN?").then(function(a){return a.slice(6)})};b.prototype.setPower=function(a){return this.atcmd("AT+CRFOP="+a)};b.prototype.getPower=function(){return this.atcmd("AT+CRFOP?").then(function(a){return parseInt(a.slice(7))})};b.prototype.send=function(a,b){var e=a.length;void 0===b&&(b=0);this.at.write("AT+SEND="+b+","+e+","+a+"\r\n")};b.prototype.getVersion=function(){return this.atcmd("AT+VER?").then(function(a){return a.slice(5)})};b.prototype.setFactory=
function(){return this.atcmd("AT+FACTORY")};exports.connect=function(a){return new b(a)}