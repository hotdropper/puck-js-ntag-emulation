function a(b,a){this.spi=b;this.csPin=a}a.prototype.seek=function(b,a){this.command(3);this.setAddress(b,a)};a.prototype.read=function(){return this.spi.send(0)};a.prototype.waitReady=function(){for(this.command(5);this.read()&1;);digitalWrite(this.csPin,1)};a.prototype.eraseChip=function(){this.command(6);this.command(199);this.waitReady()};a.prototype.erase16Pages=function(b){this.command(6);this.command(32);this.setAddress(b,0);this.waitReady()};a.prototype.writePage=function(b,a){this.startWrite(b,
0);this.spi.write(a);this.finish()};a.prototype.writePageFillSpace=function(b,a){this.startWrite(b,0);for(var c=0;256>c;c++)c<a.length?this.write(a[c]):this.write(" ");this.finish()};a.prototype.writeSector=function(b,a){for(p=0;16>p;p++)pageToWrite=b+p,pageStart=256*p,pageEnd=pageStart+256,page=a.slice(pageStart,pageEnd),this.startWrite(pageToWrite,0),this.spi.write(page),this.finish()};a.prototype.startWrite=function(b,a){this.command(6);this.command(2);this.setAddress(b,a)};a.prototype.send=function(b){return this.spi.send(b)};
a.prototype.write=function(b){this.spi.write(b)};a.prototype.finish=function(){digitalWrite(this.csPin,1);this.waitReady()};a.prototype.getJedec=function(){this.command([144,0,0,0]);var b={};b.manufacturerId=this.read();b.deviceId=this.read();digitalWrite(this.csPin,1);return b};a.prototype.getCapacity=function(){this.command(159);this.read();var b=16384*this.read();digitalWrite(this.csPin,1);return b};a.prototype.command=function(b){digitalWrite(this.csPin,1);digitalWrite(this.csPin,0);this.spi.write(b)};
a.prototype.setAddress=function(b,a){this.spi.write([b>>8&255,b>>0&255,a>>0&255])};a.prototype.readPage=function(a){this.seek(a,0);return this.spi.send({data:0,count:256})};a.prototype.readSector=function(a){this.seek(16*a,0);return this.spi.send({data:0,count:4096})};a.prototype.readPageString=function(a){var b="";this.seek(a,0);for(i=0;256>i;i++)b+=String.fromCharCode(this.spi.send(0));return b};exports.connect=function(b,c){var d=new a(b,c);jedec=d.getJedec();if(239!=jedec.manufacturerId||19!=
jedec.deviceId)d=null;return d};exports=a