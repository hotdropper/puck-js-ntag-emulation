exports.connect=function(k){return new r(k)};var r=function(k){var n=this,g="S",h=0,p=-1,l=void 0,q=0,m=0;this.ser=k;this.seq=1;this.timeout=10;this.callbacks=[];this.rxcb=void 0;k.on("data",function(c){for(var a in c){var b=c.charCodeAt(a);switch(g){case "S":126==b&&(m=0,l=void 0,q=0,g="LH");break;case "LH":h=255*b;g="LL";break;case "LL":h+=b;g="FT";255>h&&(l=new Uint8Array(h-1));break;case "FT":p=b;g="D";h--;m+=b;break;case "D":l[q++]=b;m+=b;0===--h&&(g="CS");break;case "CS":b==255-
(m&255)?n.prepCB(p,l):console.log("xBee: Checksum Fail"),g="S"}}});this.prepCB=function(c,a){var b={},d,e,f=0;if(136==c)for(f=a[0],b.cmd=String.fromCharCode(a[1],a[2]),b.status=a[3],b.data=[],d=4;d<a.length;d++)b.data.push(a[d]);else if(139==c)f=a[0],b.destination=[a[1],a[2]],b.retrycount=a[3],b.delivery_status=a[4],b.discovery_status=a[5];else if(144==c){b.addr64=new Uint8Array(8);for(d=0;8>d;d++)b.addr64[d]=a[d];b.addr16=new Uint8Array(2);b.addr16[0]=a[8];b.addr16[1]=a[9];b.option=a[10];b.data=
new Uint8Array(a.length-11);d=11;for(e=0;d<a.length;d++)b.data[e++]=a[d];void 0!==this.rxcb&&this.rxcb(b)}else console.log("xBee: Unknown Frametype: "+c.toString(16));0<f&&(clearTimeout(this.callbacks[f][1]),this.callbacks[f][0](!0,b),delete this.callbacks[f])};this.regCB=function(c,a){var b=setTimeout(function(){n.cancelCB(c)},1E3*this.timeout);this.callbacks[c]=[a,b]};this.cancelCB=function(c){this.callbacks[c][0](!1,"");delete this.callbacks[c]};this.AT=function(c,a,b){c=this.atFrame(c,a);this.ser.write(c);
this.regCB(c[4],b)};this.TX=function(c,a,b,d,e){c=this.transmitFrame(c,a,b,d);this.ser.write(c);this.regCB(c[4],e)};this.RX=function(c){this.rxcb=c};this.transmitFrame=function(c,a,b,d){var e,f=new Uint8Array(17+d.length+1);f.set([126,0,0,16,this.seq]);var g=5;for(e=0;e<c.length;e++)f[g++]=c[e];for(e=0;e<a.length;e++)f[g++]=a[e];f[g++]=0;f[g++]=b;for(e=0;e<d.length;e++)f[g++]=d[e];this.calcLandC(f);this.seq++;255<this.seq&&(this.seq=1);return f};this.atFrame=function(c,a){var b,d=new Uint8Array(7+
a.length+1);d.set([126,0,0,8,this.seq,c.charCodeAt(0),c.charCodeAt(1)]);var e=0;for(b=7;e<a.length;e++)d[b++]=a[e];this.calcLandC(d);this.seq++;255<this.seq&&(this.seq=1);return d};this.calcLandC=function(c){var a=c.length-4;var b=0;c[2]=a&255;c[1]=a>>8;for(a=3;a<c.length;a++)b+=c[a];c[c.length-1]=255-(b&255)}}