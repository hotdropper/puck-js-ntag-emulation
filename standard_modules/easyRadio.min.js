function e(a){this.inCommand?this.rxBuf+=a:this.dataCallback(a)}function b(a,c){this.ser=a;this.rxBuf="";this.dataCallback=c;this.inCommand=!1;a.on("data",e.bind(this))}b.prototype.cmd=function(a,c){this.rxBuf="";this.send(a);this.inCommand=!0;var d=this;setTimeout(function(){var b=d.rxBuf.indexOf(a);0<=b?(0<b&&d.dataCallback(d.rxBuf.substr(0,b)),d.rxBuf="",d.ser.write("ACK"),setTimeout(function(){d.inCommand=!1;c&&c(null,d.rxBuf);d.rxBuf=""},200)):(d.inCommand=!1,c&&c("Command failed, expecting "+
JSON.stringify(a)+", got "+JSON.stringify(d.rxBuf)),d.rxBuf="")},100)};b.prototype.send=function(a){if(this.inCommand)throw Error("Already sending command");this.ser.write(a)};b.prototype.getFirmwareVersion=function(a){this.cmd("ER_CMD#T3",a)};b.prototype.getSerial=function(a){this.cmd("ER_CMD#L8?",a)};b.prototype.eepromWrite=function(a,c,d){this.cmd("ER_CMD#L4"+((a|256).toString(16).substr(-2)+(c|256).toString(16).substr(-2)).toUpperCase(),d)};b.prototype.eepromRead=function(a,c){this.cmd("ER_CMD#L4"+
(a|256).toString(16).substr(-2).toUpperCase()+"?",function(a,b){c(a,parseInt(b,16))})};b.prototype.setChannel=function(a,c){this.cmd("ER_CMD#C"+(0|E.clip(a,0,9)),c)};b.prototype.setGroupID=function(a,c){this.cmd("ER_CMD#L7"+(65536|a).toString(16).substr(-4),c)};b.prototype.getGroupID=function(a){this.cmd("ER_CMD#L7?",function(c,b){a(c,parseInt(b,16))})};b.prototype.getTemperature=function(a){this.cmd("ER_CMD#T7",function(c,b){a(c,parseFloat(b))})};exports.connect=function(a,c){return new b(a,c)}